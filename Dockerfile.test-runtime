FROM node:14.15.4

WORKDIR /sdk

COPY . /sdk

RUN npm install --ignore-scripts
RUN npm run build-core
RUN npm link
RUN npm link @spree/storefront-api-v2-sdk
RUN npm run build-fetchers
RUN npm pack

FROM alpine

WORKDIR /sdk

COPY --from=0 /sdk/spree-storefront-api-v2-sdk-*.tgz /sdk/storefront-api-v2-sdk.tgz

COPY ./wait-for-it.sh /sdk/
